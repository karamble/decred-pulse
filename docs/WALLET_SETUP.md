# Decred Pulse Wallet Setup Guide

This guide explains how to set up and use the watch-only wallet feature in Decred Pulse.

## Overview

Decred Pulse includes a **watch-only wallet** powered by dcrwallet. This allows you to:
- Monitor wallet balances in real-time
- View transaction history
- Generate receiving addresses
- Track confirmations

**Important:** This is a watch-only wallet and **cannot sign transactions or spend funds**. It is designed for monitoring purposes only.

---

## Architecture

The wallet setup consists of three components:

1. **dcrwallet** - Decred wallet daemon running in Docker
2. **Backend API** - Go server that connects to dcrwallet via RPC
3. **Frontend UI** - React dashboard for wallet monitoring

All components communicate securely using TLS certificates generated by dcrd.

---

## Quick Start

### 1. Start the Services

```bash
# Make sure you have configured .env
cp env.example .env
# Edit .env and set DCRWALLET_RPC_PASS

# Start all services
docker-compose up -d

# Check wallet logs
docker logs -f decred-pulse-dcrwallet
```

### 2. Access the Wallet Dashboard

1. Open your browser to `http://localhost:3000`
2. Click the **"WALLET"** button in the header
3. Click **"Add X-Pub"** to import your extended public key

### 3. Import Your Xpub

To monitor a wallet, you need to import your extended public key (xpub):

1. Get your xpub from your existing Decred wallet:
   - **Decrediton:** Settings ‚Üí Accounts ‚Üí Export Account ‚Üí Copy xpub
   - **dcrctl:** `dcrctl --wallet getmasterpubkey default`
   
2. In the Decred Pulse wallet dashboard, click "Add X-Pub"

3. Paste your xpub (starts with `dpub` for mainnet, `tpub` for testnet)

4. Enter an account name (e.g., "main-wallet")

5. Check "Rescan blockchain after import" (recommended for first import)

6. Click "Import Xpub"

### 4. Wait for Rescan

After importing, the wallet will rescan the blockchain to find all transactions:
- **Time:** 30-60 minutes (depends on wallet age and blockchain size)
- **Progress:** Watch the progress bar on the wallet dashboard
- **Status:** "Syncing" ‚Üí "Fully Synced" when complete

---

## Wallet Seed Backup

On first run, dcrwallet creates a new wallet with a seed phrase. While this seed isn't needed for watch-only operation, it's good practice to back it up.

### View the Seed

```bash
# View seed from container logs
make wallet-seed

# Or directly:
docker logs decred-pulse-dcrwallet 2>&1 | grep -A 5 "WALLET SEED"
```

**Save this seed securely!** It's displayed only once during wallet creation.

---

## Understanding Xpub Keys

### What is an Xpub?

An **extended public key (xpub)** is a master public key that allows:
- Deriving all public keys in your wallet
- Viewing all addresses and transactions
- Monitoring balances

**It does NOT allow:**
- Spending funds
- Signing transactions
- Deriving private keys

### Xpub Format

- **Mainnet:** Starts with `dpub`
- **Testnet:** Starts with `tpub`
- **Length:** ~111 characters

Example:
```
dpubZF4LSCdF7y8x8CX1mGz4DEKHGTy9Jd5jMmhJPfTqPqTcC8Rk...
```

### Getting Your Xpub

#### From Decrediton:
1. Settings ‚Üí Accounts
2. Click on the account you want to export
3. Click "Export Account" or "Advanced"
4. Copy the "Extended Public Key"

#### From dcrctl:
```bash
dcrctl --wallet getmasterpubkey default
```

#### From dcrwallet RPC:
```bash
curl -k -u user:pass https://localhost:9110 \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"1.0","method":"getmasterpubkey","params":["default"],"id":1}'
```

---

## Wallet Operations

### View Wallet Info

```bash
make wallet-info
```

Shows:
- Wallet version
- Daemon connection status
- Unlocked status
- Transaction count

### Check Balance

```bash
make wallet-balance
```

Shows balance in DCR for all accounts.

### View Wallet Logs

```bash
make logs-dcrwallet
```

Monitor wallet activity and rescan progress.

### Shell Access

```bash
make shell-dcrwallet
```

Access the wallet container for manual operations.

---

## Dashboard Features

### Wallet Status Card

Shows:
- **Fully Synced** - Wallet is up to date
- **Syncing** - Blockchain rescan in progress
- **No Xpub Imported** - Need to import xpub
- **Disconnected** - Cannot reach dcrd

### Account Balance Card

Displays:
- **Total Balance** - All funds in the account
- **Spendable** - Confirmed balance
- **Immature** - Staking rewards pending maturity
- **Unconfirmed** - Pending transactions

### Transaction List

Shows recent transactions with:
- Transaction type (receive, send, ticket, vote)
- Amount and confirmations
- Timestamp
- Link to blockchain explorer

### Address List

Displays generated addresses with:
- Usage status (used/unused)
- BIP44 derivation path
- Copy to clipboard button
- Blockchain explorer link

---

## Rescanning the Blockchain

A rescan is required when:
- Importing an xpub for the first time
- The wallet missed transactions while offline
- You want to refresh transaction history

### Trigger Rescan via UI

1. Go to Wallet Dashboard
2. The rescan option appears when importing xpub
3. Check "Rescan blockchain after import"

### Trigger Rescan via API

```bash
curl -X POST http://localhost:8080/api/wallet/rescan \
  -H "Content-Type: application/json" \
  -d '{"beginHeight": 0}'
```

### Monitor Rescan Progress

The wallet dashboard shows:
- Progress percentage
- Blocks scanned per interval
- Estimated time remaining

---

## Multiple Accounts

You can import multiple xpub keys for different accounts:

1. Import first xpub with account name "account1"
2. Import second xpub with account name "account2"
3. Dashboard shows combined balance across all accounts

Each xpub is tracked separately in the wallet database.

---

## Security Considerations

### What's Safe

‚úÖ **Sharing your xpub** - Safe for monitoring services  
‚úÖ **Importing to multiple devices** - No security risk  
‚úÖ **Public networks** - Cannot spend funds  

### What to Protect

üîí **Private passphrase** - Stored securely in container  
üîí **Wallet seed** - Backup but not needed for watch-only  
üîí **RPC credentials** - Keep credentials secure  

### Privacy Considerations

‚ö†Ô∏è **Address linking** - Xpub reveals all addresses in account  
‚ö†Ô∏è **Balance visibility** - Anyone with xpub can see balance  
‚ö†Ô∏è **Transaction history** - Full history is visible  

**Best Practice:** Use different accounts for different purposes (privacy, savings, staking).

---

## Troubleshooting

### Wallet Won't Start

```bash
# Check logs
docker logs decred-pulse-dcrwallet

# Common issues:
# 1. Certificates not ready - wait for dcrd
# 2. Port conflict - check if 9110 is in use
# 3. Permission issues - check volume permissions
```

### Import Xpub Fails

**Error:** "Invalid xpub format"
- **Solution:** Ensure xpub starts with `dpub` (mainnet) or `tpub` (testnet)

**Error:** "Wallet RPC not connected"
- **Solution:** Check if dcrwallet is running: `docker ps | grep dcrwallet`

**Error:** "Wallet locked"
- **Solution:** Wallet should auto-unlock. Check logs for passphrase errors.

### Rescan Takes Too Long

- **Normal:** 30-60 minutes for full rescan
- **Speed up:** Rescan only from wallet creation date (not from block 0)
- **Monitor:** Watch progress in dashboard or logs

### Balance Shows Zero

1. **Check rescan status** - Must complete before balances appear
2. **Verify xpub** - Ensure correct xpub was imported
3. **Check network** - Mainnet xpub on mainnet, testnet on testnet
4. **Wait for sync** - dcrd must be fully synced first

### Missing Transactions

1. **Trigger rescan** - May have missed blocks
2. **Check block height** - Ensure wallet is synced to latest block
3. **Verify addresses** - Check if addresses are in wallet

---

## Advanced Configuration

### Custom Rescan Start Height

If you know when your wallet was created, start rescan from that block:

```bash
# Find block height by date
# https://dcrdata.decred.org/

# Trigger rescan from specific height
curl -X POST http://localhost:8080/api/wallet/rescan \
  -H "Content-Type: application/json" \
  -d '{"beginHeight": 500000}'
```

### Manual Wallet Operations

Access wallet directly via dcrctl:

```bash
docker exec -it decred-pulse-dcrwallet /bin/sh

# Inside container:
dcrctl --wallet \
  --rpcuser=$DCRWALLET_RPC_USER \
  --rpcpass=$DCRWALLET_RPC_PASS \
  --rpcserver=127.0.0.1:9110 \
  --rpccert=/certs/rpc.cert \
  <command>
```

Available commands:
- `walletinfo` - Wallet information
- `getbalance` - Account balance
- `listtransactions` - Transaction history
- `listaddresses` - All addresses
- `getnewaddress` - Generate new address

---

## Data Persistence

Wallet data is stored in Docker volume `dcrwallet-data`:

```bash
# Backup wallet data
docker run --rm \
  -v decred-pulse_dcrwallet-data:/data \
  -v $(pwd)/backups:/backup \
  alpine tar czf /backup/dcrwallet-backup-$(date +%Y%m%d).tar.gz -C /data .

# Restore wallet data
docker run --rm \
  -v decred-pulse_dcrwallet-data:/data \
  -v $(pwd)/backups:/backup \
  alpine tar xzf /backup/dcrwallet-backup-YYYYMMDD.tar.gz -C /data
```

---

## API Reference

### Get Wallet Status

```bash
GET /api/wallet/status
```

Returns sync status and wallet state.

### Get Wallet Dashboard

```bash
GET /api/wallet/dashboard
```

Returns complete wallet data (balance, transactions, addresses).

### Import Xpub

```bash
POST /api/wallet/importxpub
Content-Type: application/json

{
  "xpub": "dpub...",
  "accountName": "imported",
  "rescan": true
}
```

### Trigger Rescan

```bash
POST /api/wallet/rescan
Content-Type: application/json

{
  "beginHeight": 0
}
```

---

## FAQ

**Q: Can I spend funds from this wallet?**  
A: No, this is a watch-only wallet. To spend, use Decrediton or dcrwallet with your seed.

**Q: Is my xpub secure to import?**  
A: Yes, xpubs only reveal public keys. However, they do expose your full transaction history.

**Q: Can I import multiple wallets?**  
A: Yes, import multiple xpubs with different account names.

**Q: What happens if I lose my xpub?**  
A: You can re-export it from your main wallet anytime. The xpub doesn't change.

**Q: Do I need the seed phrase?**  
A: Not for watch-only operation. The seed is only for wallet recovery if you want to spend.

**Q: How often should I rescan?**  
A: Only when importing a new xpub or if transactions are missing.

---

## Support

For issues or questions:
- GitHub Issues: https://github.com/karamble/decred-pulse/issues
- Decred Community: https://decred.org/community/
- Documentation: https://docs.decred.org/

---

## Related Documentation

- [Docker Setup Guide](DOCKER_SETUP.md)
- [Building from Source](BUILDING_FROM_SOURCE.md)
- [Quick Start Guide](QUICKSTART.md)
- [dcrwallet Documentation](https://github.com/decred/dcrwallet)

